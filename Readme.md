# Complex System Simulations
Code of Group 4 for the course complex system simulation at the UvA 2018-2019.

## Default Simulation
The configuration file should be of the following form:
```json
{
    "height": 100,
    "width": 100,
    "slope": 0.5,
    "gamma": 0.01,
    "rho": 0.0002,
    "mu": 0.00014, 
    "concentration_of_nutrients": 0,
    "water_per_timestep": 1,
    "generator_type": "pnoise2",
    "generator_parameters": {
        "roughness": 1
    },
    "timesteps": 100,
    "timestep_per_statistics": 10,
    "no_of_settlements": 0,
    "settlement_demand": 0.5,
    "number_of_water_flows": 1,
    "evaporation": 0.00001
}
```

It is wise to name the configuration file as `configuration_X.json` where X is some string which identifies the experiment. This convention makes it possible to run the simulation with the command 
```python3
python main.py X
```

## Running Chained Simulations
It is possible to chain the simulations, i.e. it is possible to first run a simulation with configuration `configuration_X.json` and then continue with configuration `configuration_Y.json`. The simulation with configuration `configuration_X.json` should first be ran to obtain `output_X.json`, then the `configuration_Y.json` should contain the parameter output_file_to_load with the name of the output file without extension.

For example, the following configuration file can be used to run a simulation continuing on the terrain generated by the configuration in the section above (if called `configuration_24start.json`).
```json
{
    "experiment": "24a",
    "output_file_to_load": "24start",
    "height": 100,
    "width": 100,
    "slope": 0.5,
    "gamma": 0.01,
    "rho": 0.0002,
    "mu": 0.00014, 
    "concentration_of_nutrients": 0,
    "water_per_timestep": 1,
    "generator_type": "pnoise2",
    "generator_parameters": {
        "roughness": 1
    },
    "timesteps": 100,
    "timestep_per_statistics": 10,
    "no_of_settlements": 0,
    "settlement_demand": 0.5,
    "number_of_water_flows": 1,
    "evaporation": 0.00001
}
```

## Generating images
The generated `output_X.json` can be visualized by running the TerrainPlotter class. Various types of plots can be generated, see the file for the options.

## General usage
The general way to run an experiment is by generating a configuration file and saving it as e.g. `configuration_experiment1.json`. Now by running 
```bash
./main.py experiment1 && ./output_to_gif.sh experiment1 
```
the simulation will run and output ./output_experiment1.json. Additionally a GIF will be generated and saved as ./images/animated_experiment1.gif if ffmpeg is installed on the system.

## Notes
The ./Experiments directory contains most of the experiments which we have ran throughout the course. Every sub-directory will contain configuration files along with GIFs, the number should correspond. Please note that replicating these experiments may yield different results since the experiment might have been ran with an older version of the code.

## Running an example
On Unix-like systems the `./example_run.sh` will automatically generate a configuration file, run the simulations, generate the images and convert them into a GIF. The images can be found in the `images` directory and the GIF should be identical to the GIF in the `example` directory. Possibly you need to run `chmod +x example_run.sh` first to make the script executable.
